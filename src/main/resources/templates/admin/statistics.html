<!DOCTYPE html>

<html xmlns:th="http://www.thymeleaf.org">

<head> <meta charset="UTF-8">

    <title>Thống kê</title>
    <!-- Đường dẫn tới các tệp CSS của Bootstrap -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>

        body { background-color: #f1f4f6 }

        h3 {
            text-align: center;
            margin-top: 20px;
            margin-bottom: 20px;
            color: rgb(2,88,155);
        }
        h4 {
            margin-top: 0px;
            margin-bottom: 20px;
            color: rgb(2,88,155);
        }
        .frame-main {
            border-radius: 5px;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .frame-main-3 {
            border: 2px solid rgb(182,232,241);
            border-radius: 5px;
            padding: 20px;
            border-radius: 15px
        }
        .frame-main-2 {
            border: 2px solid rgb(182,232,241);
            border-radius: 5px;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .thead-title {
            border-radius: 25px;
            overflow: hidden;
            background-color: rgb(182,232,241);
            color: black;
            border-radius: 15px
        }
        .thead-title th:first-child {
            border-top-left-radius: 15px;
        }

        .thead-title th:last-child {
            border-top-right-radius: 15px;
        }

        tr:last-child td:first-child {
            border-bottom-left-radius: 15px;
        }
        tr:last-child td:last-child {
            border-bottom-right-radius: 15px;
        }

        table {
            border-collapse: collapse;
        }
        td {
            border: 1px solid rgb(242,242,242);
        }

        .form-statistics {
			color: grey;
			margin-top: 10px;
		}


        .badge-wait-item {
            color: white;
            background-color: orange;
        }

        .container-main {
            border-radius: 15px;
            padding: 15px;
            margin: 40px;
        }
        .container-main {
            box-shadow: 0 8px 10px rgb(226, 226, 226);
        }

        .material-symbols-outlined.back {
            color: rgb(2,88,155);
        }

        .material-symbols-outlined.back:hover {
            color: rgb(182,232,241);
        }

        .row-01{
			padding: 40px;
			background-color: #f2fbff;
		}
		.title-icon{
			padding: 10px;
			margin-right: 20px;
			background-color: white;
			box-shadow: 0 8px 10px rgb(226, 226, 226);
			border-radius: 15px;
			height: 80px;
			width: 80px;
		}
        .title-icon:hover {
			box-shadow: 0 8px 10px #d7ebff;
		}

        .btn-detail {
            background-color: white;
            border-radius: 15px;
            height: 70px;
            width: 200px;
            color: #62bf5e;
            box-shadow: 0px 0px 10px rgba(192, 192, 192, 0.5);
            font-weight: bold;
            margin: 20px;
        }

        .btn-detail:hover {
            box-shadow: 0px 0px 10px rgba(144, 238, 144, 0.5);
            background-color: #62bf5e;
            color: white;
            font-weight: bold;
            margin: 20px;
        }

        /* Style cho pop up */
        .popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
            z-index: 9999;
            height: 120px;
        }
		/* Style cho lớp phủ */
        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 9998;
        }

		.btn-close-popup {
			border: none;
			border-radius: 10px;
			margin: 15px;
			background-color: #3f6ad8;
			color: white;
			font-weight: bold;
			width: 50px;
			height: 35px;
		}
		.btn-close-popup:hover {
			color: white;
		}

        .btn-search{
			color: #5390f5;
			border-radius: 50px;
			border: 1px solid #5390f5;
			background-color: white;
			font-weight: bold;
			width: 180px;
		}
		.btn-search:hover {
			color: white;
			border-radius: 50px;
			border: 1px solid #5390f5;
			background-color: #5390f5;
			font-weight: bold;
		}
        .btn-6-months{
			color: #5bb56f;
			border-radius: 50px;
			border: 1px solid #5bb56f;
			background-color: white;
			font-weight: bold;
			width: 200px;
		}
		.btn-6-months:hover {
			color: white;
			border-radius: 50px;
			border: 1px solid #5bb56f;
			background-color: #5bb56f;
			font-weight: bold;
		}
    </style>
</head>

<body>
<div th:replace="~{admin/headeradmin :: header}"></div>
<div class="container-expand d-flex" style="margin: 0px; padding: 0px; width: 100%">
    <div class="col-03" style="width: 17%">
        <div th:replace="~{admin/sidebar :: sidebar}"></div>
    </div>

    <div class="col-08" style="width: 83%">
        <div class="row-01 d-flex align-items-center">
            <div class="title-icon" >
                <img src="https://res.cloudinary.com/dylwewmt0/image/upload/v1715193278/PHOTO_LIST/Admin/Title-icon/09.png" alt="Knowledge Young" style="width: 100%; height: 100%">
            </div>
            <div class="col-title">
                <p style="margin: 0px; color: #3f6ad8; font-size: 18px; font-weight: bold; font-family: Helvetica;">THỐNG KÊ</p>
                <div class="form-statistics">
                    <p style="font-family: Helvetica; margin: 0px">Doanh thu, lợi nhuận</p>
                </div>
            </div>
        </div>
        <div class="container-main" style="background-color: white;">
            <form action="#" th:action="@{/statistics}" method="get" class="form-inline" style="margin: 15px 0px">
                <div class="form-group mb-2">
                    <label for="startDate" class="sr-only">Ngày bắt đầu</label>
                    <input type="date" class="form-control" id="startDate" name="startDate" th:value="${startDate}" required>
                </div>
                <div class="form-group mx-sm-3 mb-2">
                    <label for="endDate" class="sr-only">Ngày kết thúc</label>
                    <input type="date" class="form-control" id="endDate" name="endDate" th:value="${endDate}" required>
                </div>
                <button type="submit" class="btn btn-search mb-2">Xem thống kê</button>
                <a th:if="${isCustomDateRange}" th:href="@{/statistics}" class="btn btn-6-months mb-2 ml-2">Xem 6 tháng gần đây</a>
            </form>

            <div class="overlay" id="overlay"></div>

            <div th:if="${param.message}" class="popup" id="popup">
                <div class="row-announce">
                    <span style="color: #5b5a7a; font-weight: bold;" th:text="${param.message}"></span>
                </div>
                <div class="row-close d-flex align-items-center justify-content-center">
                    <button class="btn btn-close-popup" onclick="closePopup()">Ok</button>
                </div>
            </div>

            <h5 th:if="${isCustomDateRange}" style="color: #f17746; font-family: 'Museo Moderno', sans-serif;">Doanh thu</h5>
            <h5 th:if="${!isCustomDateRange}" style="color: #f17746; font-family: 'Museo Moderno', sans-serif;">Doanh thu 6 tháng gần đây</h5>
            <canvas id="revenueChart"></canvas>

            <div class="detail d-flex align-items-center justify-content-center">
                <a th:href="@{/managerevenues}" class="btn btn-detail d-flex align-items-center justify-content-center">Chi tiết doanh thu</a>
            </div>

            <h5 th:if="${isCustomDateRange}" style="color: #f17746; font-family: 'Museo Moderno', sans-serif;">Lợi nhuận</h5>
            <h5 th:if="${!isCustomDateRange}" style="color: #f17746; font-family: 'Museo Moderno', sans-serif;">Lợi nhuận 6 tháng gần đây</h5>
            <canvas id="profitChart"></canvas>

            <div class="detail d-flex align-items-center justify-content-center">
                <a th:href="@{/manageprofits}" class="btn btn-detail d-flex align-items-center justify-content-center">Chi tiết lợi nhuận</a>
            </div>
        </div>
    </div>
</div>

<script th:inline="javascript">
    /*<![CDATA[*/
    const revenueData = /*[[${revenuesOfLastSixMonthsDataByMonth}]]*/ [];
    const profitData = /*[[${profitsOfLastSixMonthsDataByMonth}]]*/ [];
    const monthsData = /*[[${monthsOfLastSixMonths}]]*/ [];

    if(revenueData.length > 0 && profitData.length > 0) {
        const ctx1 = document.getElementById('revenueChart').getContext('2d');
        new Chart(ctx1, {
            type: 'line',
            data: {
                labels: monthsData,
                datasets: [{
                    label: 'Doanh thu',
                    data: revenueData,
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'VND'
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'Tháng'
                        }
                    }
                }
            }
        });

        const ctx2 = document.getElementById('profitChart').getContext('2d');
        new Chart(ctx2, {
            type: 'line',
            data: {
                labels: monthsData,
                datasets: [{
                    label: 'Lợi nhuận',
                    data: profitData,
                    backgroundColor: 'rgba(255, 99, 132, 0.2)',
                    borderColor: 'rgba(255, 99, 132, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'VND'
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'Tháng'
                        }
                    }
                }
            }
        });
    } else {
        document.getElementById("popup").style.display = "block";
        document.getElementById("overlay").style.display = "block";
        document.getElementById("popup").innerHTML = "<span style='color: #5b5a7a; font-weight: bold;'>Không có dữ liệu để hiển thị</span>";
    }
    /*]]>*/
</script>

<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
<script>
    function closePopup() {
        document.getElementById("popup").style.display = "none";
        document.getElementById("overlay").style.display = "none";
    }

    if (document.getElementById("popup")) {
        document.getElementById("popup").style.display = "block";
        document.getElementById("overlay").style.display = "block";
    }
</script>
</body>

</html>
