<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Thông tin vận chuyển</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">

	<!--Thêm đoạn javascript bên dưới để có thể thực hiện dropdown Account	?\\-->
	<!-- jQuery library -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

	<!-- Popper JS -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>

	<!-- Latest compiled JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

	<style>

		body { background-color: #f8f9fa  }

		h3 {
        	text-align: center;
        	margin-top: 10px;
        	margin-bottom: 20px;
        	color: rgb(2,88,155);
    	}
    	.form-container {
	        border-radius: 15px;
	        margin-top: 40px;
        	margin-bottom: 40px;
	    }
<!--	    .btn-cancle {-->
<!--			border: 2px solid rgb(241,56,71);-->
<!--			color: rgb(0, 0, 0);-->
<!--			border-radius: 10px;-->
<!--		}-->
<!--		.btn-cancle:hover {-->
<!--			color: rgb(255, 0, 0);-->
<!--		}-->

		.btn-order {
			background-color: #3448c5;
			border-radius: 50px;
			color: white;
			width: 200px;
			box-shadow: 0px 4px 6px rgba(0, 0.4, 0, 0.2);
		}
		.btn-order:hover {
			background-color: #211f7f;
			color: white;
			box-shadow: 0px 6px 8px rgba(0, 0.4, 0, 0.2);
		}

		.frame {
			background-color:#dbdbdb;
			border-radius: 10px;
			height: 50px;
			margin-top: 20px;
        	margin-bottom: 20px;
        	display: flex;
		    justify-content: flex-end;
		    align-items: center;
		    padding: 10px;
		}
		.text-total {
			text-align: center;
		}
		.navbar-nav {
			display: frex;
		}
		.navbar-nav-left {
			width: 70%;
		}
		.navbar-nav-right {
			width: 30%;
		}
		.nav-link {
			display: flex;
      		align-items: center;
      		column-gap: 0.5rem;
      		width: fit-content;
		}
		.move-right {
			margin-left: auto;
			display: flex;
			float: right;
		}

		.form-container {
			box-shadow: 0 8px 10px rgb(226, 226, 226);

		}

		.material-symbols-outlined.back {
			color: rgb(2,88,155);
		}

		.material-symbols-outlined.back:hover {
			color: rgb(182,232,241);
		}

		.form-group.row {
			width: 360px;
			margin: 0px;
			margin-top: 10px;
		}

		.col-info {
			width: 323px;
		}

		.my-custom-modal {
            margin-top: 150px;
        }

		.modal-dialog{
			margin: 0px
		}



		.btn-address.change-address-btn {
			margin-top: 20px;
			background-color: #36aa00;
			border-radius: 50px;
			color: white;
			width: 200px;
			box-shadow: 0px 4px 6px rgba(0, 0.4, 0, 0.2);
		}

		.btn-address.change-address-btn:hover {
			margin-top: 20px;
			background-color: #228b22;
			color: white;
			box-shadow: 0px 6px 8px rgba(0, 0.4, 0, 0.2);
		}

		.alert-success {
			color: rgb(91,181,111);
		}
		.alert-danger {
			color: rgb(247,80,80);
		}

		.modal-body {
		  overflow: auto; /* hoặc overflow: scroll; */
		  max-height: 400px; /* Chiều cao tối đa của thẻ div */
		}

		.modal-dialog {
			display: flex;
			justify-content: center;
			align-items: center;
			height: 90vh;
		}

		.btn-voucher{
			background-color: white;
			color: #5390f5;
			border-radius: 15px;
			height: 40px;
			border: 1px solid #5390f5;
			font-weight: bold;
		}
		.btn-voucher:hover {
			background-color: #5390f5;
			color: white;


			border-radius: 15px;
			height: 40px;
			border: 1px solid #5390f5;
			font-weight: bold;
		}
		.btn-delete{
			background-color: white;
			color: #5b5a7a;
			border-radius: 15px;
			height: 40px;
			border: 1px solid #5b5a7a;
			font-weight: bold;
		}
		.btn-delete:hover {
			background-color: #5b5a7a;
			color: white;
			border-radius: 15px;
			height: 40px;
			border: 1px solid #5b5a7a;
			font-weight: bold;
		}
		.modal-body::-webkit-scrollbar {
            width: 10px; /* Độ rộng của thanh cuộn */
        }

        .modal-body::-webkit-scrollbar-track {
            background: #f1f1f1; /* Màu nền của thanh cuộn */
            border-radius: 10px;
        }

        .modal-body::-webkit-scrollbar-thumb {
            background: #79a7d5; /* Màu của thanh cuộn */
            border-radius: 10px; /* Bo tròn cho phần thanh cuộn */
        }

        .modal-body::-webkit-scrollbar-thumb:hover {
            background: #5591c5; /* Màu của thanh cuộn khi di chuột qua */
        }

		.btn-primary {
			background-color: #538abe;
			font-weight: bold;
			color: white;
		}
		.btn-primary:hover {
			background-color: #365e94;
			font-weight: bold;
			color: white;
		}

		.btn-success {
			background-color: #5bb56f;
			font-weight: bold;
			color: white;
		}
		.btn-success:hover {
			background-color: #36802d;
			font-weight: bold;
			color: white;
		}
		.close {
            outline: none !important;
        }
        .close:focus {
            box-shadow: none;
        }
	</style>
</head>
<body>
	<div th:replace="~{layout/header :: header}"></div>
	<!-- Hiển thị thông báo nếu có -->
	<div th:if="${param.message}" class="alert" id="myAlert02"
		 th:classappend="${#strings.containsIgnoreCase(param.message, 'thành công') ? 'alert-success' : 'alert-danger'}">
		<span th:text="${param.message}" style="font-weight: bold;justify-content: center; display: flex;"></span>
	</div>
    <div class="container-fluid mb-4">
        

		<div class="container" style="padding: 0px">
			<div class="form-container" style="background-color: white; padding: 20px">
				<div class="row-00 d-flex align-items-center" style="height: 30px; margin-bottom: 15px; margin: 0px 0px 0px; border-bottom: 1px solid #cecece; padding-bottom: 10px">
					<div class="col-00" style="display: flex; align-items: center;">
						<a th:href="@{/viewcart}" class="before" style="align-items: center; display: flex; text-decoration: none;">
							<span class="material-symbols-outlined back">arrow_back_ios</span>
						</a>
						<h6 style="color: #211f7f; align-items: center;  margin: 0px 5px 0px 0px; font-family: Verdana; font-weight: bold">Thanh toán</h6>
					</div>
				</div>

				<!-- Nếu addresses rỗng, chỉ hiển thị nút Thêm địa chỉ -->
				<div th:unless="${addresses != null && addresses.size() > 0}">
					<p>Vui lòng thêm thông tin địa chỉ để có thể đặt hàng!</p>
					<a th:href="@{/addaddress}" class="btn btn-success">Thêm địa chỉ</a>
				</div>

		        <form th:if="${addresses != null && addresses.size() > 0}" id="myForm" th:action="@{/placeorder}" method="post" style="width: 100%">
					<div class="row-01 d-flex justify-content-center" style="width: 100%; border-bottom: 1px solid #cecece;">
						<div class="col-01" style="width: 65%; padding-right: 20px; border-right: 1px solid #cecece; padding-bottom: 15px">
							<div class="row-001 d-flex align-items-center" style="padding: 20px 0px 20px 0px;">
								<h6 class="text-left" style="margin: 0px">Quyển sách đã chọn</h6>
								<div class="form-cart" th:if="${selectedCartItems != null}"
									 style="color: orangered; align-items: center; font-weight: 500; d-flex align-items-center; margin-left: 5px">
									<p style="margin: 0px 0px 0px">
										<span th:text="'(' + ${selectedCartItems.size()} + ' quyển sách)'"></span>
									</p>
								</div>
							</div>
							<table>
								<thead>
								<tr style="width: 100%; height: 50px;  background-color: #d9e1f7; margin-top: 10px; border-radius: 10px">
									<th class="align-middle text-center" style="width: 50%; text-align: center; padding: 10px 10px">Tên sách</th>
									<th class="align-middle text-center" style="width: 10%; text-align: center; padding: 10px 10px">Số lượng</th>
									<th class="align-middle " style="width: 20%; text-align: right; padding: 10px 10px">Giá</th>
									<th class="align-middle " style="width: 20%; text-align: right; padding: 10px 10px">Tổng cộng</th>
								</tr>
								</thead>
								<tbody>
									<tr th:each="cartItem : ${selectedCartItems}"
										name="cartItemId"
										data-category-id="${cartItem.book.category.id}"
										th:data-price="${cartItem.book.currentDiscount != null ? cartItem.book.currentDiscount.discountedPrice : cartItem.book.sellPrice}"
										th:data-quantity="${cartItem.quantity}"
										onmouseover="this.style.backgroundColor='#f2fbff';" onmouseout="this.style.backgroundColor='transparent';" style="border: 1px solid #cecece; background-color: transparent;">
											<td th:text="${cartItem.book.name}" class="align-middle" style="text-align: center; padding: 10px 0px"></td>
											<td th:text="${cartItem.quantity}" class="align-middle text-center" style="text-align: center; padding: 10px 0px"></td>
											<td th:text="${cartItem.book.currentDiscount != null ? #numbers.formatInteger(cartItem.book.currentDiscount.discountedPrice, 0, 'POINT')+ ' đ' : #numbers.formatInteger(cartItem.book.sellPrice, 0, 'POINT')+ ' đ'}" class="align-middle" style="text-align: right; padding: 10px 10px"></td>
											<td th:text="${cartItem.book.currentDiscount != null ? #numbers.formatInteger(cartItem.quantity * cartItem.book.currentDiscount.discountedPrice, 0, 'POINT')+ ' đ' : #numbers.formatInteger(cartItem.quantity * cartItem.book.sellPrice, 0, 'POINT')+ ' đ'}" class="align-middle" style="text-align: right; padding: 10px 10px"></td>
									</tr>
								</tbody>
							</table>
							<div class="frame-price" style="background-color: white; margin-top: 20px">
								<div class="row-voucher d-flex align-items-center">
									<!-- Thêm nút để thêm/ đổi voucher -->
									<a onmouseover="this.style.color='white';"
									   onmouseout="this.style.color='#5390f5';"
									   th:if="${vouchers != null || !vouchers.isEmpty() }" type="button"
									   class="btn btn-voucher d-flex align-items-center" data-toggle="modal" data-target="#voucherModal" style="color: #5390f5;">
										<span class="material-symbols-outlined" style="display: flex; margin-right: 5px">redeem</span>
										Vouchers
									</a>

									<!-- Thêm phần tử HTML để hiển thị mã code voucher -->
									<h6 th:if="${selectedVoucher != null}" id="appliedVoucherCode" style=" color: #5b5a7a; font-weight: bold; margin: 0px 0px 0px 30px;">Áp dụng: <span th:text="${selectedVoucher.code}"></span></h6>
									<!-- Thêm nút để xóa voucher -->
									<button type="button" th:if="${selectedVoucher != null}" id="removeVoucherButton" style="margin-left: 20px" class="btn-delete">Xóa Voucher</button>
								</div>
								<div class="row-pay d-flex" style="width: 100%; margin: 20px 0px">
									<div class="col-08" style="width: 80%">
										<div class="row-01">
											<h6 style="margin: 0px; font-weight: bold; text-align: right;">Thành tiền:</h6>
										</div>
										<div class="row-02" style="margin-top: 15px">
											<h6 th:if="${selectedVoucher != null}" style="margin: 0px; font-weight: bold; text-align: right;">Giảm giá:</h6>
										</div>
										<div class="row-03" style="margin-top: 15px">
											<h6 th:if="${selectedVoucher != null}" style="margin: 0px; font-weight: bold; text-align: right;">Tổng số tiền:</h6>
										</div>
									</div>
									<div class="col-04" style="width: 20%">
										<div class="row-01">
											<h6 style="margin: 0px; font-weight: bold; text-align: right;"><span id="totalAmount" th:data-value="${totalAmount}" th:text="${#numbers.formatInteger(totalAmount, 0, 'POINT') + ' đ'}" style="color: orangered; "></span></h6>
										</div>
										<div class="row-02" style="margin-top: 15px">
											<!-- Thêm phần tử HTML để hiển thị giá được giảm bởi voucher -->
											<h6 th:if="${selectedVoucher != null}" id="voucherDiscount" style="margin: 0px; font-weight: bold; text-align: right;"><span th:text="'-' + ${#numbers.formatInteger(voucherDiscount, 0, 'POINT') + ' đ'}" style="color: #93979b;"></span></h6>
										</div>
										<div class="row-03" style="margin-top: 15px">
											<!-- Thêm phần tử HTML để hiển thị giá đã giảm từ voucher -->
											<h6 th:if="${selectedVoucher != null}" id="discountedPrice" style="margin: 0px; font-weight: bold; text-align: right;"><span th:text="${#numbers.formatInteger(discountedPriceByVoucher, 0, 'POINT') + ' đ'}"
																																										 style="color: orangered; padding: 5px 10px; border-radius: 10px; background-color: #ffebae;"></span></h6>
										</div>
									</div>
								</div>
								<div class="text-total" >
								</div>

								<div class="text-total" >

								</div>
								<div class="text-total" >

								</div>


							</div>
						</div>
						<!-- Nếu addresses không rỗng, hiển thị các input -->
						<div class="col-02 d-flex align-items-center justify-content-center" style="flex-direction: column; width: 35%; padding-left: 20px; padding-bottom: 15px">
							<h6 class="text-left" style="padding: 20px 0px 10px 0px; margin: 0px">Địa chỉ nhận hàng</h6>
							<div class="form-group row d-flex align-items-center" style="border-radius: 50px; border: 1px solid #cecece;">
								<span class="material-symbols-outlined" style="color: grey; margin: 5px">person_2</span>
								<div class="col-info">
									<input type="text" id="name" name="name" th:value="${addresses[0].recipientName}" required class="form-control"
										   style="border-top-right-radius: 50px; border-bottom-right-radius: 50px; padding: 0px 10px 0px 0px; border: none;">
								</div>
							</div>

							<div class="form-group row d-flex align-items-center" style="border-radius: 50px; border: 1px solid #cecece;">
								<span class="material-symbols-outlined" style="color: grey; margin: 5px">location_on</span>
								<div class="col-info">
									<input type="text" id="address" name="address" th:value="${account.address}" required class="form-control"
										   style="border-top-right-radius: 50px; border-bottom-right-radius: 50px; padding: 0px 10px 0px 0px; border: none;">
								</div>
							</div>
							<div class="form-group row d-flex align-items-center" style="border-radius: 50px; border: 1px solid #cecece;">
								<span class="material-symbols-outlined" style="color: grey; margin: 5px">call</span>
								<div class="col-info">
									<input type="text" id="phoneNumber" name="phoneNumber" th:value="${addresses[0].phoneNumber}" required class="form-control"
										   style="border-top-right-radius: 50px; border-bottom-right-radius: 50px; padding: 0px 10px 0px 0px; border: none;">
								</div>
							</div>
							<div class="form-group row d-flex align-items-center" style="border-radius: 50px; border: 1px solid #cecece;">
								<span class="material-symbols-outlined" style="color: grey; margin: 5px">mail</span>
								<div class="col-info">
									<input type="email" id="email" name="email" th:value="${account.email}" required class="form-control"
										   style="border-top-right-radius: 50px; border-bottom-right-radius: 50px; padding: 0px 10px 0px 0px; border: none;">
								</div>
							</div>
							<!-- Button trigger modal -->
							<button type="button" class="btn btn-address change-address-btn" data-toggle="modal" data-target="#changeAddressModal" th:attr="data-id=${addresses[0].id}">
								Chọn địa chỉ có sẵn
							</button>

						</div>

					</div>

		            <div class="form-group row-01" style="padding-bottom: 10px;">
						<div class="row-01 d-flex align-items-center">
							<span class="material-symbols-outlined" style="color: #5390f5; margin-right: 5px">paid</span>
							<label for="paymentMethods" class="col col-form-label" style="padding: 10px 0px; color: #5390f5; font-weight: bold">
								Phương thức thanh toán:
							</label>
						</div>
						<div class="row-02 d-flex align-items-center" style="width: 100%">
							<div class="col-001" style="width: 30%; border: 1px solid #cecece; border-radius: 50px;">
								<select id="paymentMethods" name="paymentMethods" class="form-control" style="border: none; border-radius: 50px" onchange="changeIcon(this.value)">
									<option value="cash"> Thanh toán khi nhận hàng</option>
									<option value="VNPAY">Cổng thanh toán VNPAY</option>
								</select>
							</div>
							<div class="col-002 d-flex align-items-center justify-content-center" style="width: 70%; padding-left: 20px">
								<img id="paymentIcon" src="https://res.cloudinary.com/dylwewmt0/image/upload/v1713775052/PHOTO_LIST/shippinginfomation/cash02.png" height="38" style="margin-right: 10px">
								<p style="margin: 0px; font-weight: 600">-  Bạn chỉ nên nhận hàng khi trạng thái</p>
								<h5 style="margin: 0px 10px 0px 10px; color: #5390f5;">"ĐANG GIAO HÀNG"</h5>
								<p style="margin: 0px; font-weight: 600">được cập nhật</p>
							</div>
						</div>
		            </div>
					<div class="text-center">
						<input type="hidden" name="idSelectedCartItems" id="idSelectedCartItems" th:value="${idSelectedCartItems}">
						<input th:if="${selectedVoucher != null}" type="hidden" name="voucherId" id="voucherIdForPlaceOrder" th:data-voucherId="${selectedVoucherId}"th:value="${selectedVoucherId}">
						<button type="submit" class="btn btn-order">Đặt hàng</button>
					</div>
		        </form>
			</div>
		</div>
    </div>

	<!-- Modal hiển thị pop up để chọn địa chỉ khác -->
	<div  th:if="${addresses != null && addresses.size() > 0}"  class="modal fade my-custom-modal" id="changeAddressModal" tabindex="-1" role="dialog" aria-labelledby="changeAddressModalLabel" aria-hidden="true" style="z-index: 9999; margin: 0px">
		<div class="modal-dialog" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); border-radius: 15px" role="document">
			<div class="modal-content"  style="border-radius: 15px">
				<div class="modal-header" style="border-bottom: 1px solid white;">
					<div class="row-title d-flex">
						<span class="material-symbols-outlined" style="color: #365e94; margin: 0px; padding-right: 5px">distance</span>
						<h6 class="modal-title" id="changeAddressModalLabel" style="color: #365e94;">Chọn địa chỉ</h6>
					</div>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">×</span>
					</button>
				</div>
				<div class="scroll-wrapper" style="overflow-y: auto;">
					<div class="modal-body">
						<!-- Đặt giá trị của addresses[0].id vào thuộc tính data-id của form -->
						<form id="changeAddressForm" th:attr="data-id=${addresses[0].id}">
							<div th:each="address : ${addresses}">
								<div class="card mb-3" style="border-radius: 15px" onmouseover="this.style.backgroundColor='#f2f8f8';"
									 onmouseout="this.style.backgroundColor='transparent';">
									<div class="card-body">
										<div class="row-address d-flex justify-content-center">
											<div class="col-3 " style="padding-left: 0px; flex-direction: column; justify-content: center">
												<img src="https://res.cloudinary.com/dylwewmt0/image/upload/v1717097101/PHOTO_LIST/Location/1.png" alt="Knowledge Young" style="width: 80px;">
											</div>
											<div class="col-8" style="padding-right: 0px">
												<p class="card-text" style="margin-bottom: 8px; color: #211f7f; font-weight: bold">
													<span class="recipientName" th:text="${address.recipientName}"></span> - <span class="phoneNumber" th:text="${address.phoneNumber}"></span>
												</p>
												<p class="card-text" style="font-size: 1em; color: #7A7E7F; font-family: 'Nunito Sans' !important; margin-bottom: 8px">
													<span class="cityName" th:text="${address.city.name}"></span>, <span class="districtName" th:text="${address.district.name}"></span>, <span class="wardName" th:text="${address.ward.name}"></span>
												</p>
												<p class="card-text" style="font-size: 1em; color: #7A7E7F; font-family: 'Nunito Sans' !important; margin-bottom: 8px">
													<span class="addressDetails" th:text="${address.addressDetails}"></span>
												</p>
												<p class="card-text" style="font-size: 1em; color: #7A7E7F; font-family: 'Nunito Sans' !important; margin-bottom: 8px">
													<span th:text="${address.addressNote}"></span>
												</p>
												<p class="card-text" style="font-size: 1em; color: #7A7E7F; font-family: 'Nunito Sans' !important; margin-bottom: 8px">
													Loại địa chỉ: <span th:text="${address.addressType == 0 ? 'Văn phòng' : 'Nhà'}"></span>
												</p>
												<p class="card-text" style="font-size: 1em; color: #7A7E7F; font-family: 'Nunito Sans' !important; margin-bottom: 8px">
													Mặc định: <span th:text="${address.isDefault == 1 ? 'Có' : 'Không'}"></span>
												</p>
											</div>
											<div class="col-1" style="padding-right: 0px">
												<input style="width: 15px; height: 15px" type="radio" name="addressId" th:value="${address.id}" th:checked="${address.id == addresses[0].id}">
											</div>
										</div>
									</div>
								</div>
							</div>
						</form>
					</div>
				</div>
				<div class="modal-footer" style="border-top: 1px solid white;">
					<!-- Thêm nút "Thêm địa chỉ" -->
					<a th:href="@{/addaddress}" class="btn btn-success" style="border-radius: 15px; font-weight: bold;">Thêm địa chỉ</a>
					<button type="button" class="btn btn-secondary" style="border-radius: 15px; font-weight: bold;" data-dismiss="modal">Đóng</button>
					<button type="button" class="btn btn-primary" style="border-radius: 15px" id="changeAddressConfirm">Chọn</button>
				</div>
			</div>
		</div>
	</div>

	<!-- Đoạn mã HTML cho modal đổi Voucher -->
	<div class="modal fade" id="voucherModal" tabindex="-1" role="dialog" aria-labelledby="voucherModalLabel" aria-hidden="true">
		<div class="modal-dialog" style=" top: 50%; left: 50%; transform: translate(-50%, -50%); border-radius: 15px; height: 100%"  role="document">
			<div class="modal-content"  style="border-radius: 15px">
				<div class="modal-header" style="border-bottom: 1px solid white;">
					<div class="row-title d-flex">
						<span class="material-symbols-outlined" style="color: #365e94; margin: 0px; padding-right: 5px">redeem</span>
						<h6 class="modal-title" id="voucherModalLabel" style="color: #365e94;">Chọn Voucher</h6>
					</div>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<!-- -->
					<form id="selectVoucherForm">
						<div th:each="voucher : ${vouchers}">
							<div class="card mb-3" style="border-radius: 15px" onmouseover="this.style.backgroundColor='#f2f8f8';"
								 onmouseout="this.style.backgroundColor='transparent';">
								<div class="card-body" style="margin-radius: 15px">
									<div class="row-voucher d-flex justify-content-center">
										<div class="col-3 " style="padding-left: 0px; flex-direction: column; justify-content: center">
											<img src="https://res.cloudinary.com/dylwewmt0/image/upload/v1717093858/PHOTO_LIST/Vouchers/discount.png" alt="Knowledge Young" style="width: 100px;">
										</div>
										<div class="col-8" style="padding-right: 0px">
											<p class="card-text" style="margin-bottom: 8px">
												<span class="voucherCode" id="voucherCode_${voucher.id}" th:text="${voucher.code}" style="color: #f17746; font-weight: bold"	></span>
											</p>
											<p class="card-text" th:if="${voucher.category != null}" style="font-size: 1em; color: #7A7E7F; font-family: 'Nunito Sans' !important; margin-bottom: 8px">
												Dành cho danh mục: <span id="voucherCategory_${voucher.id}" class="voucherCategory" th:text="${voucher.category.name}" th:data-category-id="${voucher.category.id}"></span>
											</p>
											<p class="card-text" th:if="${voucher.category == null}" style="font-size: 1em; color: #7A7E7F; font-family: 'Nunito Sans' !important; margin-bottom: 8px">
												Dành cho mọi sách
											</p>
											<p class="card-text" style="font-size: 1em; color: #7A7E7F; font-family: 'Nunito Sans' !important; margin-bottom: 8px">
												Chỉ còn: <span class="voucherRemainingQuantity" id="voucherRemainingQuantity_${voucher.id}" th:text="${voucher.remainingQuantity} + ' lượt'"></span>
											</p>
											<p class="card-text" th:if="${voucher.discountPercent != -1}" style="font-size: 1em; color: #7A7E7F; font-family: 'Nunito Sans' !important; margin-bottom: 8px">
												Giảm: <span id="voucherDiscountPercent_${voucher.id}" class="voucherDiscountPercent" th:text="${voucher.discountPercent} + '%'"></span>
											</p>
											<p class="card-text" th:if="${voucher.amountDiscount != -1}" style="font-size: 1em; color: #7A7E7F; font-family: 'Nunito Sans' !important; margin-bottom: 8px">
												Giảm: <span id="voucherAmountDiscount_${voucher.id}" class="voucherAmountDiscount" th:text="${#numbers.formatInteger(voucher.amountDiscount, 0, 'POINT')} + ' đ'"></span>
											</p>
											<p class="card-text" style="font-size: 1em; color: #7A7E7F; font-family: 'Nunito Sans' !important; margin-bottom: 8px">
												Đơn hàng từ: <span id="voucherMinimumOrderValue_${voucher.id}" class="voucherMinimumOrderValue" th:text="${#numbers.formatInteger(voucher.minimumOrderValue, 0, 'POINT')} + ' đ'"></span>
											</p>
											<p class="card-text" style="font-size: 1em; color: #7A7E7F; font-family: 'Nunito Sans' !important; margin-bottom: 8px">
												Hạn sử dụng: <span class="voucherEndDate" id="voucherEndDate_${voucher.id}" th:text="${#temporals.format(voucher.endDate.toLocalDateTime(), 'dd/MM/yyyy HH:mm:ss')}"></span>
											</p>
										</div>
										<div class="col-1" style="padding-right: 0px">
											<input style="width: 15px; height: 15px" type="radio" id="voucherId_${voucher.id}" name="voucherId" th:value="${voucher.id}" th:data-id="${voucher.id}" th:data-percent="${voucher.discountPercent}" th:data-amount="${voucher.amountDiscount}" th:data-minvalue="${voucher.minimumOrderValue}" th:checked="${voucher.id == selectedVoucherId}">
										</div>
									</div>
								</div>
							</div>
						</div>
					</form>
				</div>
				<div class="modal-footer" style="border-top: 1px solid white;">
					<button type="button" class="btn btn-secondary" data-dismiss="modal" style="border-radius: 15px; font-weight: bold;">Đóng</button>
					<form id="voucherForm" th:action="@{/shippinginformation}" method="post">
						<!-- Các trường form khác ở đây -->
						<input type="hidden" name="idSelectedCartItems" id="idSelectedCartItemsWithVoucher" th:data-idSelectedCartItems="${idSelectedCartItems}" th:value="${idSelectedCartItems}">
						<!-- Trường mới để lưu trữ ID voucher -->
						<input type="hidden" name="voucherId" id="voucherId" th:data-voucherId="${selectedVoucherId}" th:value="${selectedVoucherId}">
						<button type="button" class="btn btn-primary" id="selectVoucherConfirm" style="border-radius: 15px">Áp dụng Voucher</button>
					</form>
				</div>
			</div>
		</div>
	</div>
	<!-- Kết thúc đoạn mã HTML cho modal đổi Voucher -->

    <div th:replace="~{layout/footer :: footer}"></div>
	<script>
		function changeIcon(paymentMethod) {
            var paymentIcon = document.getElementById('paymentIcon');
            if (paymentMethod == 'cash') {
                paymentIcon.src = 'https://res.cloudinary.com/dylwewmt0/image/upload/v1713775052/PHOTO_LIST/shippinginfomation/cash02.png';
            } else if (paymentMethod == 'VNPAY') {
                paymentIcon.src = 'https://res.cloudinary.com/dylwewmt0/image/upload/v1713774779/PHOTO_LIST/shippinginfomation/VNPAY.png';
            }
        }
	</script>

	<script>
		$(document).ready(function() {
			// Lấy id của địa chỉ đang được chọn từ thuộc tính data-id của form
			var currentAddressId = $('#changeAddressForm').data('id');

			$('#changeAddressConfirm').click(function() {
				var selectedAddressId = $('input[name="addressId"]:checked').val();
				if (selectedAddressId) {
					// Cập nhật id của địa chỉ đang được chọn
					currentAddressId = selectedAddressId;

					// Cập nhật địa chỉ nhận hàng trên giao diện
					var selectedAddress = $('input[name="addressId"]:checked').closest('.card-body');
					$('#name').val(selectedAddress.find('.recipientName').text());
					$('#phoneNumber').val(selectedAddress.find('.phoneNumber').text());
					$('#address').val(selectedAddress.find('.addressDetails').text() + ', ' +
									  selectedAddress.find('.wardName').text() + ', ' +
									  selectedAddress.find('.districtName').text() + ', ' +
									  selectedAddress.find('.cityName').text());

					// Gửi yêu cầu đến máy chủ để cập nhật địa chỉ nhận hàng
					// ...

					// Đóng modal
					$('#changeAddressModal').modal('hide');
				}
			});

			// Khi mở modal, chọn radio button tương ứng với địa chỉ đang được chọn
			$('#changeAddressModal').on('show.bs.modal', function() {
				$('input[name="addressId"][value="' + currentAddressId + '"]').prop('checked', true);
			});
		});

		function displayAlert(message, alertType) {
			// Kiểm tra xem đã có thông báo chưa
			if (document.getElementById('myAlert02')) {
				return;
			}

			var alertBox = document.createElement('div');
			alertBox.className = 'alert ' + alertType;
			alertBox.id = 'myAlert02';
			alertBox.style.fontWeight = 'bold';
			alertBox.style.justifyContent = 'center';
			alertBox.style.display = 'flex';

			var alertText = document.createElement('span');
			alertText.textContent = message;

			alertBox.appendChild(alertText);

			// Tìm phần tử header và chèn thông báo ngay sau nó
			var header = document.getElementsByTagName('header')[0];
			header.parentNode.insertBefore(alertBox, header.nextSibling);

			// Thông báo sẽ tự động biến mất sau 10 giây
			setTimeout(function() {
				alertBox.remove();
			}, 10000);
		}

		var myAlert02 = document.getElementById('myAlert02'); // Tránh bị null
		// Đặt thời gian cho alert
		if (myAlert02){
			setTimeout(function() {
			document.getElementById('myAlert02').style.display = 'none';
			}, 10000);  // Alert sẽ biến mất sau 10 giây
		}

		// Khi người dùng chọn Voucher
		$(document).ready(function() {
			// Khi người dùng nhấn nút xác nhận
			$('#selectVoucherConfirm').click(function() {
				// Lấy id của voucher đang được chọn
				var selectedVoucherId = $('input[name="voucherId"]:checked').val();

				// Cập nhật giá trị của trường ẩn voucherId trong form
				$('#voucherId').val(selectedVoucherId);

				// Gửi form đi
				$('#voucherForm').submit();
			});
		});

		$(document).ready(function() {
			// Khi người dùng nhấn nút xóa voucher
			$('#removeVoucherButton').click(function() {
				// Đặt là -1 để voucher trả về null
				$('#voucherId').val(-1);

				// Gửi form đi
				$('#voucherForm').submit();
			});
		});



<!--		// Khai báo currentVoucherId ở vị trí cao nhất-->
<!--		var currentVoucherId;-->

<!--		// Tạo hàm để hủy áp dụng voucher-->
<!--		function cancelVoucherApplication() {-->
<!--			// Hủy áp dụng voucher-->
<!--			currentVoucherId = null;-->

<!--			// Ẩn mã code voucher, giá được giảm bởi voucher, giá đã giảm từ voucher và nút hủy áp dụng voucher-->
<!--			$('#appliedVoucherCode').hide();-->
<!--			$('#voucherDiscount').hide();-->
<!--			$('#discountedPrice').hide();-->
<!--			$('#removeVoucherButton').hide();-->

<!--			// Bỏ chọn tất cả các radio button-->
<!--			$('input[name="voucherId"]').prop('checked', false);-->
<!--		}-->


<!--		// Tạo hàm để tính toán tổng giá giỏ hàng khi đã nhấn chọn/ đổi Voucher-->
<!--		function calculateTotalPriceWithVoucher(selectedVoucherId) {-->
<!--			// Cập nhật voucher đang được chọn-->
<!--			currentVoucherId = selectedVoucherId;-->
<!--			var selectedVoucher = $('input[name="voucherId"]:checked').closest('.card-body');-->
<!--			var category = selectedVoucher.find('.voucherCategory').text();-->
<!--        var voucherCode = selectedVoucher.find('.voucherCode').text();-->
<!--			var minimumOrderValue = parseFloat($('input[name="voucherId"]:checked').data('minvalue'));-->
<!--			var totalAmount = parseFloat($('#totalAmount').data('value'));-->

<!--			// Hiển thị giá trị category, minimumOrderValue và totalpricecart lên console-->
<!--			console.log('Category: ' + category);-->
<!--			console.log('Giá trị tối thiểu của voucher: ' + minimumOrderValue);-->
<!--			console.log('Giá trị đơn hàng: ' + totalAmount);-->

<!--			// Kiểm tra xem voucher (mọi sách) có thể áp dụng cho đơn hàng hay không-->
<!--			if (category == '' && minimumOrderValue <= totalAmount) {-->
<!--				var discountPercent = parseFloat($('input[name="voucherId"]:checked').data('percent'));-->
<!--				var amountDiscount = parseFloat($('input[name="voucherId"]:checked').data('amount'));-->

<!--				// Hiển thị giá trị discountPercent và amountDiscount lên console-->
<!--				console.log('Phần trăm giảm giá: ' + discountPercent);-->
<!--				console.log('Số tiền giảm giá: ' + amountDiscount);-->

<!--				// Tính toán giá đã giảm-->
<!--				var discountedPrice = totalAmount;-->
<!--				// Giá trị được giảm giá từ voucher-->
<!--				var voucherDiscount = 0;-->
<!--				if (discountPercent != -1) {-->
<!--					voucherDiscount = totalAmount * discountPercent / 100;-->
<!--					discountedPrice -= voucherDiscount;-->
<!--				} else if (amountDiscount != -1) {-->
<!--					voucherDiscount = amountDiscount;-->
<!--					discountedPrice -= voucherDiscount;-->
<!--				}-->

<!--				// Hiển thị giá đã giảm lên console-->
<!--				console.log('Giá đã giảm: ' + discountedPrice);-->

<!--				// Hiện mã code đang được áp dụng lên giao diện-->
<!--				$('#appliedVoucherCode').text('Mã code voucher: ' + voucherCode).show();-->
<!--				// Cập nhật giá được giảm từ voucher lên giao diện-->
<!--				$('#voucherDiscount').text('-' + voucherDiscount.toLocaleString('vi-VN', {style : 'currency', currency : 'VND'})).show();-->
<!--				// Cập nhật giá đã giảm trên giao diện-->
<!--				$('#discountedPrice').text(discountedPrice.toLocaleString('vi-VN', {style : 'currency', currency : 'VND'})).show();-->
<!--				// Hiển thị nút xóa voucher-->
<!--				$('#removeVoucherButton').show();-->
<!--			} else if (category != '') {// Kiểm tra xem voucher (danh mục cụ thể) có thể áp dụng cho đơn hàng hay không-->
<!--				var categoryId = selectedVoucher.find('.voucherCategory').data('category-id');-->

<!--				console.log('=== categoryId: ' + categoryId);-->
<!--				// Tính tổng giá trị các mặt hàng thuộc về danh mục-->
<!--				var totalCategoryValue = Array.from(document.querySelectorAll('tr[data-category-id="' + categoryId + '"]')).reduce(function(total, row) {-->
<!--					var discountPercent = parseFloat($('input[name="voucherId"]:checked').data('percent'));-->
<!--                	var amountDiscount = parseFloat($('input[name="voucherId"]:checked').data('amount'));-->
<!--					if (isNaN(price)) {-->
<!--						price = 0;-->
<!--					}-->
<!--					if (isNaN(quantity)) {-->
<!--						quantity = 0;-->
<!--					}-->
<!--					return total + price * quantity;-->
<!--				}, 0);-->

<!--				console.log('Giá trị các mặt hàng thuộc về danh mục: ' + totalCategoryValue);-->


<!--				// Kiểm tra xem tổng giá trị các mặt hàng thuộc về danh mục có lớn hơn hoặc bằng minimumOrderValue không-->
<!--				if (totalCategoryValue >= minimumOrderValue) {-->
<!--					var discountPercent = parseFloat($('input[name="voucherId"]:checked').data('percent'));-->
<!--					var amountDiscount = parseFloat($('input[name="voucherId"]:checked').data('amount'));-->

<!--					// Tính toán giá đã giảm dựa trên tổng giá trị các mặt hàng thuộc về danh mục-->
<!--					var discountedPrice = totalAmount;-->
<!--					// Giá trị được giảm giá từ voucher-->
<!--					var voucherDiscount = 0;-->
<!--					if (discountPercent != -1) {-->
<!--						// Nếu là % thì giá cuối cùng = tổng giá giỏ hàng - totalCategoryValue * discountPercent / 100-->
<!--						voucherDiscount = totalCategoryValue * discountPercent / 100;-->
<!--						discountedPrice -= voucherDiscount;-->
<!--					} else if (amountDiscount != -1) {-->
<!--						// Nếu nó là số tiền mặt thì lấy luôn giá cuối cùng = tổng giá giỏ hàng - amount-->
<!--						voucherDiscount = amountDiscount-->
<!--						discountedPrice -= voucherDiscount;-->
<!--					}-->

<!--					// Hiện mã code đang được áp dụng lên giao diện-->
<!--					$('#appliedVoucherCode').text('Mã code voucher: ' + voucherCode).show();-->
<!--					// Cập nhật giá được giảm từ voucher lên giao diện-->
<!--					$('#voucherDiscount').text('-' + voucherDiscount.toLocaleString('vi-VN', {style : 'currency', currency : 'VND'})).show();-->
<!--					// Cập nhật giá đã giảm trên giao diện-->
<!--					$('#discountedPrice').text(discountedPrice.toLocaleString('vi-VN', {style : 'currency', currency : 'VND'})).show();-->
<!--					// Hiển thị nút xóa voucher-->
<!--					$('#removeVoucherButton').show();-->
<!--				} else {-->
<!--					// Hiển thị thông báo lỗi-->
<!--					var message = 'Tổng giá trị các mặt hàng thuộc danh mục ' + category + ' trong đơn hàng của bạn nhỏ hơn giá trị tối thiểu của voucher. Vui lòng chọn một voucher khác hoặc tăng giá trị đơn hàng của bạn.';-->
<!--					displayAlert(message, 'alert-danger');-->
<!--					cancelVoucherApplication();-->
<!--				}-->
<!--			} else {-->
<!--				// Hiển thị thông báo lỗi-->
<!--				var message = 'Giá trị đơn hàng của bạn nhỏ hơn giá trị tối thiểu của voucher. Vui lòng chọn một voucher khác hoặc tăng giá trị đơn hàng của bạn.';-->
<!--				displayAlert(message, 'alert-danger');-->
<!--				cancelVoucherApplication();-->
<!--			}-->
<!--		}-->

<!--		// Xử lý tổng giá giỏ hàng khi đã nhấn chọn Voucher-->
<!--		$(document).ready(function() {-->
<!--			// Lấy id của voucher đang được chọn-->
<!--			$('#selectVoucherConfirm').click(function() {-->
<!--				var selectedVoucherId = $('input[name="voucherId"]:checked').val();-->
<!--				if (selectedVoucherId) {-->
<!--					calculateTotalPriceWithVoucher(selectedVoucherId);-->
<!--					// Đóng modal-->
<!--					$('#voucherModal').modal('hide');-->
<!--				}-->
<!--			});-->

<!--			// Khi mở modal, chọn radio button tương ứng với voucher đang được chọn-->
<!--			$('#voucherModal').on('show.bs.modal', function() {-->
<!--				if (currentVoucherId) {-->
<!--					$('input[name="voucherId"][value="' + currentVoucherId + '"]').prop('checked', true);-->
<!--				}-->
<!--			});-->

<!--			$('#removeVoucherButton').click(function() {-->
<!--				cancelVoucherApplication();-->
<!--			});-->
<!--		});-->

	</script>
</body>
</html>